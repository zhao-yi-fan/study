<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous" />
  <script src="/node_modules/vue/dist/vue.js"></script>
</head>

<body>
  <div id="app">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <input type="file" accept="image/*" @change="handleChange" />
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <img className="img-responsive" ref="showImage" @load="drawImage()" :src="dataURL" alt="" v-if="file"
               style="border: 2px dashed green;">
        </div>
        <div class="col-md-4">
          <div style="position: relative;">
            <canvas width="300px" ref="canvas" height="300px" style="border: 2px dashed green;"></canvas>
            <div
                 style="width:100px;height:100px;position: absolute;left:100px;top:100px;background-color: yellow;opacity: 0.3;">

            </div>
          </div>
        </div>
        <div class="col-md-4"></div>
      </div>
    </div>
  </div>

  <script>
    new Vue({
      el: "#app",
      data() {
        return {
          file: null, // 选中的文件
          dataURL: "", // base64
        };
      },
      methods: {
        handleChange(e) {
          let file = e.target.files[0];
          let fileReader = new FileReader();
          fileReader.onload = (e) => {
            this.file = file;
            this.dataURL = e.target.result;
            this.$refs.showImg
          };
          fileReader.readAsDataURL(file);
        },
        drawImage() {
          console.dir(this.$refs.showImage, 'this.$refs.showImage;===');
          let image = this.$refs.showImage;
          let canvas = this.$refs.canvas;
          let ctx = canvas.getContext('2d');
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          let imageWidth = image.width;
          let imageHeight = image.height;
          if (imageWidth > imageHeight) {
            let scale = canvas.width / imageWidth;
            imageWidth = canvas.width;
            imageHeight = imageHeight * scale;
          } else {
            let scale = canvas.height / imageHeight;
            imageHeight = canvas.height;
            imageWidth = imageWidth * scale;
          }
          ctx.drawImage(image, 0, 0, imageWidth, imageHeight)
        }
      },
      mounted() { },
    });
  </script>
</body>

</html>