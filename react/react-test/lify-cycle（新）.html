<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="//unpkg.com/react@17.0.2/umd/react.development.js" crossorigin></script>
  <script src="//unpkg.com/react-dom@17.0.2/umd/react-dom.development.js" crossorigin></script>
  <script src="//unpkg.com/babel-standalone@6/babel.min.js"></script>
  <title>Document</title>
</head>

<body>
  <div id="app"></div>
  <script type="text/babel">
    class Father extends React.Component {

      constructor(props) {
        console.log('Father--constructor');
        super(props)

        this.state = {
          count: 1
        }
      }

      add = () => {
        this.setState({
          count: this.state.count + 1
        })
      }

      clickHandle = () => {
        ReactDOM.unmountComponentAtNode(document.querySelector('#app'))
      }

      force = () => { // 不判断 shouldComponentUpdate true false，都会继续走钩子
        this.forceUpdate()
      }

      // 不推荐使用
      // UNSAFE_componentWillMount () {
      //   console.log('Father--componentWillMount');
      // }

      // 当前state的更新在任何时候都取决于props的值
      static getDerivedStateFromProps (props, state) {
        console.log('Father--getDerivedStateFromProps', props, state);
        // return props;
        return null;
      }

      componentDidMount () {
        console.log('Father--componentDidMount');
      }

      // 组件更新时的“阀门”
      shouldComponentUpdate () {
        console.log('Father--shouldComponentUpdate');
        return true
      }

      // 快照 在更新之前获取快照
      getSnapshotBeforeUpdate () {
        console.log('Father--getSnapshotBeforeUpdate');
        return 'xxx'
      }

      // 不推荐使用
      // UNSAFE_componentWillUpdate () {
      //   console.log('Father--componentWillUpdate');
      // }

      // props state都是旧的
      componentDidUpdate (preProps, preState, preValue) {
        console.log('Father--componentDidUpdate', preProps, preState, preValue);
      }

      componentWillUnmount () {
        console.log('Father--componentWillUnmount');
      }


      render () {
        console.log('Father--render');
        const { count } = this.state
        return (
          <div>
            <button onClick={this.add}>点我+1</button>
            <br />
            <button onClick={this.clickHandle}>组件卸载</button>
            <br />
            <button onClick={this.force}>不更改状态强制更新</button>
            <Son count={this.state.count} />
          </div>
        )
      }
    }
    class Son extends React.Component {
      // 不推荐使用
      // 组件将要接受参数，在第一次渲染时不执行
      // UNSAFE_componentWillReceiveProps (props) {
      //   console.log('Son--componentUpdateReceiveProps', props);
      // }

      shouldComponentUpdate () {
        console.log('Son--shouldComponentUpdate');
        return true
      }

      // 不推荐使用
      // UNSAFE_componentWillUpdate () {
      //   console.log('Son--componentWillUpdate');
      // }

      componentDidUpdate () {
        console.log('Son--componentDidUpdate');
      }

      render () {
        console.log('Son--render');
        return (
          <div>

            <p>子组件</p>
            <p>数量:{this.props.count}</p>
          </div >
        )
      }
    }
    const domContainer = document.querySelector('#app');
    ReactDOM.render(
      <Father name={'tom'}/>,
      domContainer);

  </script>
</body>

</html>